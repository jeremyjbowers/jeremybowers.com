<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wine bottles</title>

    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <style>
        #wine-rating-by-type-key {margin: 0 0 10px; padding-bottom: 10px; }
        #wine-rating-by-type-key span { display: inline-block; line-height: 20px; font-size: 12px; margin-right: 10px;}
        #wine-rating-by-type-key span.key { width: 8px; line-height:20px; text-indent: -99999px; margin-right: 0px;}

        img.wine-by-type { width:100%; }

        span.wine { display: inline-block; background-color: #fff;}
        span.orange { background-color: #e8b80f;  opacity: 0.5;}
        span.red { background-color: #eb163d;  opacity: 0.5;}
        span.sparkling { background-color: #2df00d;  opacity: 0.5;}
        span.white { background-color: #c8f5f5;  opacity: 0.5;}
        span.dessert { background-color: #1c52de;  opacity: 0.5;}
        span.sherry { background-color: #705614;  opacity: 0.5;}
        span.pink { background-color: #d992b8;  opacity: 0.5;}
        #wine-rating-by-type { padding-bottom: 0; padding-top:0;}
        #wine-rating-by-type-ticks { margin: 0; padding-top: 0; padding-bottom: 0; line-height: 8px; font-size: 8px;}
        #wine-rating-by-type-labels { margin: 0; padding-top: 0; padding-bottom: 0;}
        #wine-rating-by-type-ticks span { display: block; float:left; font-size: 4px; line-height:4px; text-align: center; border-left: 1px solid #aaa; border-right:1px solid #aaa; margin: 0 1px;}
        #wine-rating-by-type-labels span { display: block; float:left; font-size: 11px; line-height:20px; text-align: center; border-top: 1px solid #999; margin: 0 1px;}
        #wine-rating-by-type-labels2 span { display: block; float:left; font-size: 11px; line-height:13px; text-align: center; border-top: 0px solid #999; }
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
        <div class="row">
            <h2>Bottles by quarter and type</h2>
            <div class="col-md-12" id="wine-rating-by-type-key">
                <span class="red key">&nbsp;</span>
                <span>Red</span>
                <span class="white key">&nbsp;</span>
                <span>White</span>
                <span class="orange key">&nbsp;</span>
                <span>Orange</span>
                <span class="pink key">&nbsp;</span>
                <span>Pink</span>
                <span class="sparkling key">&nbsp;</span>
                <span>Sparkling</span>
                <span class="dessert key">&nbsp;</span>
                <span>Dessert</span>
                <span class="sherry key">&nbsp;</span>
                <span>Sherry</span>
            </div>
            <div class="col-md-12" id="wine-rating-by-type"></div>
            <div class="col-md-12" id="wine-rating-by-type-ticks"></div>
            <div class="col-md-12" id="wine-rating-by-type-labels"></div>
            <div class="col-md-12" id="wine-rating-by-type-labels2"></div>
        </div>
        <div class="row">
            <h2>Bottles by type and region</h2>
            <div class="col-md-12">
<svg width="847" height="520" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0,10)"><g><path class="link" d="M5,71.45454545454545C423.5,71.45454545454545 423.5,41.45454545454545 842,41.45454545454545" style="stroke-width: 82.9091px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,288.3636363636364C423.5,288.3636363636364 423.5,103.63636363636364 842,103.63636363636364" style="stroke-width: 38px; fill: none; stroke: rgb(247, 104, 104); stroke-opacity: 0.4;"></path><path class="link" d="M5,194.59090909090907C423.5,194.59090909090907 423.5,183.59090909090907 842,183.59090909090907" style="stroke-width: 36.2727px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,366.5909090909091C423.5,366.5909090909091 423.5,223.3181818181818 842,223.3181818181818" style="stroke-width: 29.3636px; fill: none; stroke: rgb(166, 27, 118); stroke-opacity: 0.4;"></path><path class="link" d="M5,234.31818181818184C423.5,234.31818181818184 423.5,374.2272727272727 842,374.2272727272727" style="stroke-width: 25.9091px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,124.13636363636363C423.5,124.13636363636363 423.5,154.22727272727272 842,154.22727272727272" style="stroke-width: 22.4545px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,325.5C423.5,325.5 423.5,314.1363636363636 842,314.1363636363636" style="stroke-width: 15.5455px; fill: none; stroke: rgb(247, 104, 104); stroke-opacity: 0.4;"></path><path class="link" d="M5,441C423.5,441 423.5,339.1818181818182 842,339.1818181818182" style="stroke-width: 13.8182px; fill: none; stroke: rgb(219, 175, 90); stroke-opacity: 0.4;"></path><path class="link" d="M5,393.3636363636364C423.5,393.3636363636364 423.5,327.0909090909091 842,327.0909090909091" style="stroke-width: 10.3636px; fill: none; stroke: rgb(166, 27, 118); stroke-opacity: 0.4;"></path><path class="link" d="M5,140.54545454545456C423.5,140.54545454545456 423.5,260.09090909090907 842,260.09090909090907" style="stroke-width: 10.3636px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,418.0454545454545C423.5,418.0454545454545 423.5,288.59090909090907 842,288.59090909090907" style="stroke-width: 8.63636px; fill: none; stroke: rgb(58, 196, 10); stroke-opacity: 0.4;"></path><path class="link" d="M5,217.04545454545453C423.5,217.04545454545453 423.5,269.59090909090907 842,269.59090909090907" style="stroke-width: 8.63636px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,384.7272727272727C423.5,384.7272727272727 423.5,280.8181818181818 842,280.8181818181818" style="stroke-width: 6.90909px; fill: none; stroke: rgb(166, 27, 118); stroke-opacity: 0.4;"></path><path class="link" d="M5,348.45454545454544C423.5,348.45454545454544 423.5,126.0909090909091 842,126.0909090909091" style="stroke-width: 6.90909px; fill: none; stroke: rgb(166, 27, 118); stroke-opacity: 0.4;"></path><path class="link" d="M5,310.8181818181818C423.5,310.8181818181818 423.5,205.1818181818182 842,205.1818181818182" style="stroke-width: 6.90909px; fill: none; stroke: rgb(247, 104, 104); stroke-opacity: 0.4;"></path><path class="link" d="M5,156.95454545454547C423.5,156.95454545454547 423.5,421.8636363636363 842,421.8636363636363" style="stroke-width: 5.18182px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,255.04545454545453C423.5,255.04545454545453 423.5,438.77272727272725 842,438.77272727272725" style="stroke-width: 5.18182px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,462.2272727272727C423.5,462.2272727272727 423.5,242.31818181818184 842,242.31818181818184" style="stroke-width: 5.18182px; fill: none; stroke: rgb(28, 35, 201); stroke-opacity: 0.4;"></path><path class="link" d="M5,151.77272727272728C423.5,151.77272727272728 423.5,401.49999999999994 842,401.49999999999994" style="stroke-width: 5.18182px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,249.86363636363635C423.5,249.86363636363635 423.5,406.68181818181813 842,406.68181818181813" style="stroke-width: 5.18182px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,466.54545454545456C423.5,466.54545454545456 423.5,294.6363636363636 842,294.6363636363636" style="stroke-width: 3.45455px; fill: none; stroke: rgb(28, 35, 201); stroke-opacity: 0.4;"></path><path class="link" d="M5,147.45454545454544C423.5,147.45454545454544 423.5,359.54545454545456 842,359.54545454545456" style="stroke-width: 3.45455px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,316C423.5,316 423.5,275.6363636363636 842,275.6363636363636" style="stroke-width: 3.45455px; fill: none; stroke: rgb(247, 104, 104); stroke-opacity: 0.4;"></path><path class="link" d="M5,258.5C423.5,258.5 423.5,499.13636363636374 842,499.13636363636374" style="stroke-width: 1.72727px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,399.40909090909093C423.5,399.40909090909093 423.5,388.04545454545456 842,388.04545454545456" style="stroke-width: 1.72727px; fill: none; stroke: rgb(166, 27, 118); stroke-opacity: 0.4;"></path><path class="link" d="M5,160.4090909090909C423.5,160.4090909090909 423.5,452.22727272727275 842,452.22727272727275" style="stroke-width: 1.72727px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,162.13636363636363C423.5,162.13636363636363 423.5,475.68181818181824 842,475.68181818181824" style="stroke-width: 1.72727px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path><path class="link" d="M5,175.5909090909091C423.5,175.5909090909091 423.5,83.77272727272727 842,83.77272727272727" style="stroke-width: 1.72727px; fill: none; stroke: rgb(245, 197, 125); stroke-opacity: 0.4;"></path><path class="link" d="M5,412.8636363636364C423.5,412.8636363636364 423.5,238.86363636363637 842,238.86363636363637" style="stroke-width: 1.72727px; fill: none; stroke: rgb(58, 196, 10); stroke-opacity: 0.4;"></path><path class="link" d="M5,334.1363636363636C423.5,334.1363636363636 423.5,425.3181818181818 842,425.3181818181818" style="stroke-width: 1.72727px; fill: none; stroke: rgb(247, 104, 104); stroke-opacity: 0.4;"></path><path class="link" d="M5,411.1363636363636C423.5,411.1363636363636 423.5,130.40909090909093 842,130.40909090909093" style="stroke-width: 1.72727px; fill: none; stroke: rgb(58, 196, 10); stroke-opacity: 0.4;"></path><path class="link" d="M5,458.77272727272725C423.5,458.77272727272725 423.5,132.13636363636365 842,132.13636363636365" style="stroke-width: 1.72727px; fill: none; stroke: rgb(28, 35, 201); stroke-opacity: 0.4;"></path><path class="link" d="M5,423.2272727272727C423.5,423.2272727272727 423.5,463.9545454545455 842,463.9545454545455" style="stroke-width: 1.72727px; fill: none; stroke: rgb(58, 196, 10); stroke-opacity: 0.4;"></path><path class="link" d="M5,469.1363636363636C423.5,469.1363636363636 423.5,346.9545454545455 842,346.9545454545455" style="stroke-width: 1.72727px; fill: none; stroke: rgb(28, 35, 201); stroke-opacity: 0.4;"></path><path class="link" d="M5,163.86363636363635C423.5,163.86363636363635 423.5,487.409090909091 842,487.409090909091" style="stroke-width: 1.72727px; fill: none; stroke: rgb(213, 235, 178); stroke-opacity: 0.4;"></path></g><g><g class="node" transform="translate(842,474.81818181818187)"><rect height="1.7272727272727273" width="5" style="fill: rgb(102, 102, 102);"><title>Chile
1</title></rect><text x="-6" y="0.8636363636363636" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Chile</text></g><g class="node" transform="translate(842,436.1818181818182)"><rect height="5.181818181818182" width="5" style="fill: rgb(102, 102, 102);"><title>Croatia
3</title></rect><text x="-6" y="2.590909090909091" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Croatia</text></g><g class="node" transform="translate(842,0)"><rect height="133" width="5" style="fill: rgb(102, 102, 102);"><title>France
77</title></rect><text x="-6" y="66.5" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">France</text></g><g class="node" transform="translate(842,357.8181818181818)"><rect height="31.09090909090909" width="5" style="fill: rgb(102, 102, 102);"><title>Georgia
18</title></rect><text x="-6" y="15.545454545454545" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Georgia</text></g><g class="node" transform="translate(842,419.27272727272725)"><rect height="6.909090909090909" width="5" style="fill: rgb(102, 102, 102);"><title>Germany
4</title></rect><text x="-6" y="3.4545454545454546" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Germany</text></g><g class="node" transform="translate(842,486.5454545454546)"><rect height="1.7272727272727273" width="5" style="fill: rgb(102, 102, 102);"><title>Greece
1</title></rect><text x="-6" y="0.8636363636363636" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Greece</text></g><g class="node" transform="translate(842,498.27272727272737)"><rect height="1.7272727272727273" width="5" style="fill: rgb(102, 102, 102);"><title>Hungary
1</title></rect><text x="-6" y="0.8636363636363636" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Hungary</text></g><g class="node" transform="translate(842,143)"><rect height="101.9090909090909" width="5" style="fill: rgb(102, 102, 102);"><title>Italy
59</title></rect><text x="-6" y="50.95454545454545" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Italy</text></g><g class="node" transform="translate(842,451.3636363636364)"><rect height="1.7272727272727273" width="5" style="fill: rgb(102, 102, 102);"><title>New Zealand
1</title></rect><text x="-6" y="0.8636363636363636" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">New Zealand</text></g><g class="node" transform="translate(842,463.0909090909091)"><rect height="1.7272727272727273" width="5" style="fill: rgb(102, 102, 102);"><title>Portugal
1</title></rect><text x="-6" y="0.8636363636363636" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Portugal</text></g><g class="node" transform="translate(842,398.9090909090909)"><rect height="10.363636363636363" width="5" style="fill: rgb(102, 102, 102);"><title>Slovenia
6</title></rect><text x="-6" y="5.181818181818182" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Slovenia</text></g><g class="node" transform="translate(842,306.3636363636364)"><rect height="41.45454545454545" width="5" style="fill: rgb(102, 102, 102);"><title>Spain
24</title></rect><text x="-6" y="20.727272727272727" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Spain</text></g><g class="node" transform="translate(842,254.9090909090909)"><rect height="41.45454545454545" width="5" style="fill: rgb(102, 102, 102);"><title>USA
24</title></rect><text x="-6" y="20.727272727272727" dy=".35em" text-anchor="end" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">USA</text></g><g class="node" transform="translate(0,410.27272727272725)"><rect height="13.818181818181818" width="5"><title>Dessert
8</title></rect><text x="11" y="6.909090909090909" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Dessert</text></g><g class="node" transform="translate(0,174.72727272727272)"><rect height="84.63636363636364" width="5"><title>Orange
49</title></rect><text x="11" y="42.31818181818182" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Orange</text></g><g class="node" transform="translate(0,269.3636363636364)"><rect height="65.63636363636364" width="5"><title>Pink
38</title></rect><text x="11" y="32.81818181818182" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Pink</text></g><g class="node" transform="translate(0,345)"><rect height="55.27272727272727" width="5"><title>Red
32</title></rect><text x="11" y="27.636363636363637" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Red</text></g><g class="node" transform="translate(0,434.09090909090907)"><rect height="13.818181818181818" width="5"><title>Sherry
8</title></rect><text x="11" y="6.909090909090909" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Sherry</text></g><g class="node" transform="translate(0,457.9090909090909)"><rect height="12.090909090909092" width="5"><title>Sparkling
7</title></rect><text x="11" y="6.045454545454546" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">Sparkling</text></g><g class="node" transform="translate(0,30)"><rect height="134.72727272727272" width="5"><title>White
78</title></rect><text x="11" y="67.36363636363636" dy=".35em" text-anchor="start" style="font-size: 11px; font-family: Arial, Helvetica; pointer-events: none;">White</text></g></g></g></svg>
            </div>
        </div>
    </div>
    </div>
    <script src="../js/jquery.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script> -->
    <script>
    (function($){
        WINES = [];
        PAYLOAD = [];
        var draw_type_chart = function(PAYLOAD) {
            var $target = $('#wine-rating-by-type');
            var $ticks = $('#wine-rating-by-type-ticks');
            var $labels = $('#wine-rating-by-type-labels');
            var $labels2 = $('#wine-rating-by-type-labels2');
            var LABELS = {}
            $.each(PAYLOAD, function(idx, wine){
                var WINE_HTML = '<span class="wine '+wine.wine_type.toLowerCase()
                WINE_HTML += '" style="height: '+wine.score*10+'px;"';
                WINE_HTML += ' data_year="'+wine.consumed.year+'" data_quarter="'+wine.consumed.quarter+'"';
                WINE_HTML += '></span>';
                $target.append(WINE_HTML);
                if (!(wine.consumed.year in LABELS)){
                    LABELS[wine.consumed.year] = {}
                    LABELS[wine.consumed.year][wine.consumed.quarter] = 1;
                } else {
                    if (!(wine.consumed.quarter in LABELS[wine.consumed.year])){
                        LABELS[wine.consumed.year][wine.consumed.quarter] = 1;
                    } else {
                        LABELS[wine.consumed.year][wine.consumed.quarter] += 1;
                    }
                }
            });
            var WIDTH = $target.width();
            $('span.wine').css('width', WIDTH / PAYLOAD.length);
            var years = Object.keys(LABELS);
            var quarters = ["Winter","Spring","Summer","Fall"];
            $.each(years, function(i, year){
                $.each(quarters, function(z, quarter){
                    if (LABELS[year][quarter]){
                        var label_width = ((WIDTH / PAYLOAD.length)*LABELS[year][quarter]);
                        var label_text2 = quarter+'&nbsp;'+year
                        var label_text = '&nbsp;';
                        if (z % 2 == 0){
                            label_text = quarter+'&nbsp;'+year;
                            label_text2 = '&nbsp;';
                        }
                        $ticks.append('<span style="width:'+(label_width-2)+'px;">&nbsp;</span>');
                        $labels.append('<span style="width:'+(label_width-2)+'px;">'+label_text+'</span>');
                        $labels2.append('<span style="width:'+label_width+'px;">'+label_text2+'</span>');
                    }
                });
            });
        }
        var load_wines = function() { $.getJSON( "wine.json", function(wines) { format_wines(wines); }); }
        var format_wines = function(wines) {
            var avg_cost = 0.0;
            var avg_score = 0.0;
            var cost_num_wines = wines.length;
            var score_num_wines = 0;

            $.each(wines, function(idx, wine){
                wine['cost'] = parseFloat(wine['cost'].split('$')[1]);
                wine['score'] = parseFloat(wine['score']);
                wine['grapes'] = wine['grapes'].split('\n');
                wine['bottle_text'] = wine['bottle_text'].split('\n');
                WINES.push(wine);
                avg_cost += wine['cost'];

                if (!isNaN(wine['score'])) {
                    avg_score += wine['score'];
                    score_num_wines += 1;
                }
            });

            avg_cost = parseFloat(avg_cost / cost_num_wines);
            avg_score = parseFloat(avg_score / score_num_wines);

            var make_quarter = function(month){
                month = parseInt(month);
                var quarter;
                if (month < 4) { quarter = 'Winter'; }
                if (month > 9) { quarter = 'Fall'; }
                if (month > 6 && month < 10) { quarter = 'Summer'; }
                if (month > 3 && month < 7){ quarter = 'Spring'; }
                return quarter;
            };

            $.each(WINES, function(idx, wine){
                if (!isNaN(wine['score'])) {
                    wine['score+'] = wine['score'] - avg_score;
                    wine['cost+'] = wine['cost'] - avg_cost;
                    var date_split = wine['consumed'].split('/');
                    var year = date_split[2].split('20')[1]
                    var month = date_split[0]
                    wine['consumed'] = {"year": year, "quarter": make_quarter(month) }
                    PAYLOAD.push(wine);
                }
            });
            draw_type_chart(PAYLOAD);
        }
        load_wines();
    })(jQuery);
    </script>
  </body>
</html>